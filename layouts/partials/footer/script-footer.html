{{ $indexTemplate := resources.Get "js/index.js" -}}
{{ $index := $indexTemplate | resources.ExecuteAsTemplate "index.js" . -}}

{{ $bs := resources.Get "js/bootstrap.js" -}}
{{ $bs := $bs | js.Build -}}

{{ $highlight := resources.Get "js/highlight.js" -}}
{{ $highlight := $highlight | js.Build -}}

{{ $katex := resources.Get "js/vendor/katex/dist/katex.js" -}}
{{ $katexAutoRender := resources.Get "js/vendor/katex/dist/contrib/auto-render.js" -}}

{{ $mermaid := resources.Get "js/mermaid.js" | js.Build -}}

{{ $lazySizes := resources.Get "js/lazysizes.js" -}}
{{ $lazySizes := $lazySizes | js.Build -}}

{{ $clipBoard := resources.Get "js/clipboard.js" -}}
{{ $clipBoard := $clipBoard | js.Build -}}

{{ $instantPage := resources.Get "js/instant.page.js" -}}
{{ $instantPage := $instantPage | js.Build -}}

{{ $flexSearch := resources.Get "js/vendor/flexsearch/dist/flexsearch.bundle.min.js" -}}

{{ $darkMode := resources.Get "js/darkmode.js" -}}
{{ $darkMode := $darkMode | js.Build -}}

{{ $alert := resources.Get "js/alert.js" -}}
{{ $alert := $alert | js.Build -}}

{{ $katexConfig := resources.Get "js/katex.js" -}}
{{ $katexConfig := $katexConfig | js.Build -}}

{{ $scrollLock := resources.Get "js/scroll-lock.js" | js.Build -}}

{{ $toTopButton := resources.Get "js/to-top.js" -}}
{{ $toTopButton := $toTopButton | js.Build -}}

{{ $lazySizes := resources.Get "js/lazysizes.js" | default (warnf "Resource 'js/lazysizes.js' not found") }}
{{ $clipBoard := resources.Get "js/clipboard.js" | default (warnf "Resource 'js/clipboard.js' not found") }}
{{ $instantPage := resources.Get "js/instant.page.js" | default (warnf "Resource 'js/instant.page.js' not found") }}
{{ $darkMode := resources.Get "js/darkmode.js" | default (warnf "Resource 'js/darkmode.js' not found") }}
{{ $alert := resources.Get "js/alert.js" | default (warnf "Resource 'js/alert.js' not found") }}
{{ $katexConfig := resources.Get "js/katex.js" | default (warnf "Resource 'js/katex.js' not found") }}
{{ $scrollLock := resources.Get "js/scroll-lock.js" | default (warnf "Resource 'js/scroll-lock.js' not found") }}
{{ $toTopButton := resources.Get "js/to-top.js" | default (warnf "Resource 'js/to-top.js' not found") }}

{{ printf "Type of $lazySizes: %T\n" $lazySizes }}
{{ printf "Type of $clipBoard: %T\n" $clipBoard }}
{{ printf "Type of $instantPage: %T\n" $instantPage }}
{{ printf "Type of $darkMode: %T\n" $darkMode }}
{{ printf "Type of $alert: %T\n" $alert }}
{{ printf "Type of $katexConfig: %T\n" $katexConfig }}
{{ printf "Type of $scrollLock: %T\n" $scrollLock }}
{{ printf "Type of $toTopButton: %T\n" $toTopButton }}

{{ $js := slice $lazySizes $clipBoard $instantPage $darkMode $alert $katexConfig $scrollLock $toTopButton | resources.Concat "main.js" }}

{{ if eq (hugo.Environment) "development" -}}
  {{ if .Site.Params.options.bootStrapJs -}}
    <script src="{{ $bs.RelPermalink }}" defer></script>
  {{ end -}}
  {{ if .Site.Params.options.highLight -}}
    <script src="{{ $highlight.RelPermalink }}" defer></script>
  {{ end -}}
  {{ if .Site.Params.options.kaTex -}}
    <script src="{{ $katex.RelPermalink }}" defer></script>
    <script src="{{ $katexAutoRender.RelPermalink }}" onload="renderMathInElement(document.body);" defer></script>
  {{ end -}}
  <script src="{{ $js.RelPermalink }}" defer></script>
  {{ with .Params.mermaid -}}
    <script src="{{ $mermaid.RelPermalink }}" defer></script>
  {{ end -}}
  <script src="{{ $index.RelPermalink }}" defer></script>
{{ else -}}
  {{ $js := $js | minify | fingerprint "sha512" -}}
  {{ $index := $index | minify | fingerprint "sha512" -}}
  {{ $bs := $bs | minify | fingerprint "sha512" -}}
  {{ $highlight := $highlight | minify | fingerprint "sha512" -}}
  {{ $katex := $katex | minify | fingerprint "sha512" -}}
  {{ $katexAutoRender := $katexAutoRender | minify | fingerprint "sha512" -}}
  {{ $mermaid := $mermaid | minify | fingerprint "sha512" -}}
  {{ if .Site.Params.options.bootStrapJs -}}
    <script src="{{ $bs.RelPermalink }}" integrity="{{ $bs.Data.Integrity }}" crossorigin="anonymous" defer></script>
  {{ end -}}
  {{ if .Site.Params.options.highLight -}}
    <script src="{{ $highlight.RelPermalink }}" integrity="{{ $highlight.Data.Integrity }}" crossorigin="anonymous" defer></script>
  {{ end -}}
  {{ if .Site.Params.options.kaTex -}}
    <script src="{{ $katex.RelPermalink }}" integrity="{{ $katex.Data.Integrity }}" crossorigin="anonymous" defer></script>
    <script src="{{ $katexAutoRender.RelPermalink }}" integrity="{{ $katexAutoRender.Data.Integrity }}" crossorigin="anonymous" defer></script>
  {{ end -}}
  <script src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" crossorigin="anonymous" defer></script>
  {{ with .Params.mermaid -}}
    <script src="{{ $mermaid.RelPermalink }}" integrity="{{ $mermaid.Data.Integrity }}" crossorigin="anonymous" defer></script>
  {{ end -}}
  <script src="{{ $index.Permalink }}" integrity="{{ $index.Data.Integrity }}" crossorigin="anonymous" defer></script>
{{ end -}}
